<% title "Reader Account" %>
<section class="styled l-p">
  <%- if current_user.is_admin? -%>
  <p><strong>You’re an administrator.</strong> <%= link_to "Go to Admin →", admin_root_path %></p>
  <hr />
  <%- end -%>
  <h3>Personal Information</h3>
  <dl>
    <dt>Name</dt>
    <dd><%= current_user.name %></dd>
    <dt>Email</dt>
    <dd><%= current_user.email %></dd>
  </dl>

  <% if current_user.current_subscriptions.size > 0 %>
  <h3>Current Subscription<%= 's' if current_user.current_subscriptions.size > 1 %></h3>
  <% current_user.current_subscriptions.each do |sub| %>
    <dl>
      <dt>Type</dt>
      <dd><%= sub.description %></dd>
      <dt>Issues</dt>
      <% Issue.order('number ASC').where(number: sub.issues).each do |issue| %>
        <% if issue.published? %>
          <dd><%= link_to "Issue #{issue.number}", issue_path(issue: issue.number) %> <span class="c-success" title="Released">✔</span></dd>
        <% else %>
          <dd>Issue <%= issue.number %></dd>
        <% end %>
      <% end %>
    </dl>
    <% end %>
  <% end %>

  <% if current_user.subscriptions.count > current_user.current_subscriptions.size %>
  <h3>History</h3>
  <ul class="plain">
    <% current_user.subscriptions.reject{|s| current_user.current_subscriptions.collect(&:id).include?(s.id)}.each do |s| %>
      <% if s.cancelled? %>
        <li><strong><%= s.start_date %>:</strong> <del><%= s.description %> (Issues <%= s.issues.join ', ' %>)</del> <strong class="c-error">CANCELLED</strong> </li>
      <% else %>
        <li><strong><%= s.start_date %>:</strong> <%= s.description %> (Issues <%= s.issues.join ', ' %>)</li>
      <% end %>
    <% end %>
  </ul>
  <% end %>


  <hr />

  <h2>Shipping Address</h2>
  <% if current_user.shipping_address.present? %>
  <blockquote><p>
    <%= current_user.shipping_address.lines.gsub("\n", "<br/>") %><br/>
    <%= current_user.shipping_address.city %><br/>
    <%- if current_user.shipping_address.region.present? -%>
    <%= current_user.shipping_address.region %><br/>
    <%- end -%>
    <%= current_user.shipping_address.post_code %><br/>
    <%= current_user.shipping_address.country.name %><br/>
  </p></blockquote>
  <p><strong class="highlight">Address out of date?</strong> <%= link_to "Update this address.", account_address_path %></p>
  <% else %>
  <p><strong class="highlight">We have no address for you.</strong> <%= link_to "Add an address.", account_address_path %></p>
  <% end %>
  <!--
  <hr />
  <h2>Downloads</h2>
  <%- if @downloads.present? -%>
  <p>All files are DRM-free. Got questions? <%= link_to "Read our FAQ.", {controller: '/about', action: 'faq', anchor:  'downloads'} %></p>
  <div class="l-cols-m-thirds l-stack-m">
    <%- @downloads.each do |issue| -%>
    <div>
      <h3 class="h-spaced-top">Issue <%= issue.number %></h3>
      <% issue.downloads.group_by(&:medium).each do |medium, dls| %>
        <%- if issue.ownerships.any? {|o| o.can_access? medium.downcase } -%>

          <h5><%= medium %></h5>

          <ul class="plain">
            <%- dls.each do |dl| -%>
              <li><%= link_to dl.format,download_path(dl: dl.id) %> (<%= number_to_human_size dl.file_file_size %>)</li>
            <%- end -%>
          </ul>

        <%- end -%>
      <%- end -%>
    </div>
    <%- end -%>
  </div>
  <%- else -%>
  <p>You have no downloads.</p>
  <%- end -%>
  -->
</section>
